---
import Slide from '../components/Slide.astro';
import Frame from '../components/Frame.astro';
import GetInvolved from '../components/GetInvolved.astro';
---

<html lang="en">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" type="image/jpeg" href="/favicon.jpg" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
		<meta name="generator" content={Astro.generator} />
		<title>Living Library</title>
		<link rel="preconnect" href="https://fonts.googleapis.com" />
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
		<link
			href="https://fonts.googleapis.com/css2?family=Besley:ital,wght@0,400..900;1,400..900&family=Inter:wght@100..900&display=swap"
			rel="stylesheet"
		/>
		<style>
			*, *:before, *:after { 
				box-sizing: border-box; 
			}

			:root {
				/* Font */
				--font-family: 'Inter', sans-serif;
				--font-family-serif: 'Besley', serif;
				--font: clamp(1.4rem, 3vw, 1.4rem) / 1.35 var(--font-family);

				/* Colors */
				--brand-orange: hsl(24, 88%, 45%); 
				--muted-orange:  hsl(24, 50%, 45%);
				--off-white: hsl(42, 80%, 92%);
				--arrow-gray: hsl(0, 0%, 48%);
				--color-text: hsl(0, 0%, 7%);
				--color-text-inverse: hsl(0, 0%, 100%);
				--color-subtext: hsl(0, 0%, 29%);

				/* Frame */
				--frame-width: 100%;
				--frame-max-width: 100%;
				--frame-height: calc(100vh);
				--frame-height-mobile: 100dvh;

				/* Spacing */
				--space-1: 20px;
				--frame-border: 5px solid hsl(24, 50%, 45%, 80%);
				--frame-max-width: 500px;
				--progress-bar-height: 5px; 
				--progress-bar-color: hsl(24, 50%, 45%, 60%);
			}

			@supports (height: 100dvh) {
				:root {
					--frame-height: var(--frame-height-mobile);
				}
			}

			@media screen and (min-width: 500px) {
				:root {
					--frame-height: calc(100vh - 80px);
				}
			}

			html, body { 
				margin: 0; 
				padding: 0;
				height: 100%; 
			}

			body {
				background: var(--off-white);
				font: var(--font);
				position: relative;
				color: var(--color-text);
				overflow: hidden;
				display: grid;
				place-items: center;
				min-height: 100%;
				overscroll-behavior: none;
			}

			@media screen and (min-width: 500px) {
				body {
					padding-top: var(--space-1);
        	padding-left: var(--space-1);
        	padding-right: var(--space-1);
        	padding-bottom: var(--space-1);
				}
			}

			.container {
				display: flex;
				width: calc(var(--frame-width) + 8px);
				min-height: 100%;
				overflow: scroll;
				scroll-snap-type: x mandatory;
				gap: 5px;
				margin: 0 0 0 -3px;
				scrollbar-width: none;
				-webkit-overflow-scrolling: touch;
				overscroll-behavior-x: none;
				will-change: scroll-position;
				max-width: var(--frame-max-width);
			}

			@media screen and (min-width:500px) {
				.container {
					margin: 0 auto;
					border: var(--frame-border);
				}
			}

			.container::-webkit-scrollbar { 
				display: none;  
			}

			.about-section {
				text-align: center;
				max-width: 275px;
				background-color: var(--off-white);
				width: 100%;
				height: 100%;
			}

			.about-section {
				text-align: start;
				padding: 2rem;
				min-width: 100%;
				display: flex;
				flex-direction: column;
			}

			.join-a-session-section {
				text-align: start;
				padding: 2rem;
				min-width: 100%;
				display: flex;
				flex-direction: column;
			}

			.content {
				margin-top: auto;
			}

			.title {
        font-family: var(--font-family-serif), serif;
        font-size: 2.5rem; 
        color: var(--brand-orange);
        margin-bottom: 1rem;
      }
			.subtitle {
        font: var(--font);
        font-size: 1rem; 
        color: var(--color-subtext);
      }

			nav {
				margin-top: 2rem;
				font: var(--font);
				font-size: 0.9rem;
			}

			ul {
				list-style: none;
				padding: 0;
				margin: 0;
				display: flex;
				flex-direction: row;
				gap: 1rem;
			}

			ol {
				margin: 0;
				padding: 0 2rem;
				list-style-type: decimal;
				font: var(--font);
				font-size: 1rem;
				color: var(--color-subtext);
			}

			.gradient {
				background-image: linear-gradient(
					170deg,
					hsl(24deg 88% 45%) 1%,
					hsl(27deg 73% 54%) 49%,
					hsl(31deg 72% 62%) 51%,
					hsl(34deg 72% 71%) 49%,
					hsl(38deg 72% 81%) 51%,
					hsl(42deg 80% 92%) 99%
				);
			}

			.scroll-progress-container {
				position: fixed;
				bottom: 0;
				left: 0;
				width: 100%;
				height: var(--progress-bar-height);
				background-color: transparent; /* Or a light background for the track */
				z-index: 1000;
			}

			.scroll-progress-bar {
				height: 100%;
				background-color: var(--progress-bar-color);
				width: 0%; 
			}

			a {
				color: var(--muted-orange);
				font-size: 0.9rem;
			}
		</style>
	</head>
	<body>
		<main class="container">
			<Frame>
				<section class="about-section gradient">
					<div class="content">
						<h1 class="title">Living Library</h1>
						<p class="subtitle">Real people. Real stories. Real conversations.</p>
						<p class="subtitle">Connect with someone whose life experience is different from yours and have meaningful conversation</p>
						<p class="subtitle"><b>Swipe to see how it works →</b></p>
					</div>
					<nav>
						<ul>
							<li><a href="#how-it-works">How It Works</a></li>
							<li><a href="#join-a-session-section">Join a Session</a></li>
							<li><a href="#get-involved">Get Involved</a></li>
						</ul>
					</nav>
				</section>
			</Frame>
			<Frame id="how-it-works">
				<Slide 
					title="How It Works"
					subtitle='Our simple process creates meaningful connections through personal storytelling.'
					imageUrl="images/living_library.png"
					position="bottom">
					<ol>
						<li>Borrow a Living Book</li>
						<li>Have a Conversation</li>
						<li>Walk Away Changed</li>
					</ol>
				</Slide>
			</Frame>
			<Frame>
				<Slide 
					title="1. Borrow a Living Book"
					subtitle="Choose from real people who volunteer to share their lived experiences - a refugee, a former addict, someone who's been homeless, a person with disabilities."
					imageUrl="images/discovery.png"
					alt="A person browsing a catalog of living books. The image is a minimalist illustration, a hand gently reaching toward a glowing leaf on a tree at sunrise, soft orange and gold hues, nature-inspired, clean vector lines, white background, warm and inviting mood."
					position="bottom"
				/>
			</Frame>
			<Frame>
				<Slide 
					title="2. Have a Conversation"
					subtitle="Engage in a 30-minute open dialogue in a safe, respectful environment where questions are encouraged."
					imageUrl="images/conversation.png"
					alt="A person having a conversation with a living book. The image is minimalist illustration, two people facing each other, gentle sunrise light, soft orange and gold hues, nature-inspired, clean vector lines, white background, warm and inviting mood, sense of open conversation"
					position="bottom"
				/>
			</Frame>
			<Frame>
				<Slide 
					title="3. Return with a Changed Perspective"
					subtitle="Walk away with new insights, challenged assumptions, and a deeper understanding of diverse experiences."
					imageUrl="images/perception.png"
					alt="Evokes the feeling of a changed perspective. The image is a minimalist illustration, previously curled tight, now gently unfurling in the morning light. Maybe a drop of dew catches the sun, or the person is subtly different--brighter, more open--than those around it. soft orange and gold hues, nature-inspired, clean vector lines, white background, warm and inviting mood, sense of open conversation"
					position="bottom"
				/>
			</Frame>
			<Frame id="join-a-session-section">
				<section class="join-a-session-section">
					<div class="content">
						<h1 class="title">Join a Session</h1>
						<p class="subtitle">Check out our upcoming events and book a session to experience the Living Library.</p>
						<nav>
							<ul>
								<li><a href="#how-it-works">How It Works</a></li>
								<li><a href="#get-involved">Get Involved</a></li>
								<li><a href="https://lu.ma/living-library">Subscribe ↗</a></li>
							</ul>
						</nav>
					</div>
				</section>
				<iframe
					src="https://lu.ma/embed/calendar/cal-GHDfTF0OIWzcDd9/events?lt=light"
					width="var(--frame-max-width)"
					frameborder="0"
					style="border: 1px solid #bfcbda88; border-radius: 4px; height: 100%;"
					allowfullscreen=""
					aria-hidden="false"
					tabindex="0"
					title="Living Library Calendar on Luma"
				></iframe>
			</Frame>
			<Frame id="get-involved">
				<GetInvolved />
			</Frame>
		</main>
		<div class="scroll-progress-container">
			<div class="scroll-progress-bar"></div>
		</div>
	</body>

	<script>
    const container = document.querySelector('.container');
		const progressBar = document.querySelector('.scroll-progress-bar');

		// Progress bar update
		if (container && progressBar) {
			container.addEventListener('scroll', () => {
				const scrollLeft = container.scrollLeft;
				const scrollWidth = container.scrollWidth - container.clientWidth;
				
				if (scrollWidth <= 0) {
					progressBar.style.width = '0%';
					return;
				}
				
				const scrollPercent = Math.min(100, (scrollLeft / scrollWidth) * 100);
				progressBar.style.width = scrollPercent + '%';
			}, { passive: true });
		}

		// Safe click handling that doesn't interfere with native scrolling
		let clickStartTime = 0;
		let clickStartX = 0;
		let clickStartY = 0;
		let isUserScrolling = false;
		let scrollTimeout = null;
		const isAndroid = /Android/i.test(navigator.userAgent);

		// Track when user is actively scrolling
		if (container && !isAndroid) {
			container.addEventListener('scroll', () => {
				isUserScrolling = true;
				clearTimeout(scrollTimeout);
				scrollTimeout = setTimeout(() => {
					isUserScrolling = false;
				}, 150);
			}, { passive: true });

			// Track mouse/touch down for click validation
			container.addEventListener('mousedown', (e) => {
				clickStartTime = Date.now();
				clickStartX = e.clientX;
				clickStartY = e.clientY;
			}, { passive: true });

			container.addEventListener('touchstart', (e) => {
				clickStartTime = Date.now();
				clickStartX = e.touches[0].clientX;
				clickStartY = e.touches[0].clientY;
			}, { passive: true });

			// Handle clicks only if they're genuine clicks (not scrolls/swipes)
			container.addEventListener('click', (e) => {
				const clickDuration = Date.now() - clickStartTime;
				const deltaX = Math.abs(e.clientX - clickStartX);
				const deltaY = Math.abs(e.clientY - clickStartY);
				const movement = Math.sqrt(deltaX * deltaX + deltaY * deltaY);

				// Don't handle if:
				// - User is currently scrolling
				// - Click took too long (likely a drag)
				// - Too much movement (likely a swipe)
				// - Clicking on interactive elements
				if (isUserScrolling || 
					clickDuration > 200 || 
					movement > 10 ||
					e.target.tagName === 'A' || 
					e.target.closest('a') ||
					e.target.tagName === 'IFRAME' ||
					e.target.closest('.iframe-container') ||
					e.target.tagName === 'BUTTON' ||
					e.target.closest('button')) {
					return;
				}

				// Get click position relative to container
				const rect = container.getBoundingClientRect();
				const clickX = e.clientX - rect.left;
				const containerWidth = rect.width;

				// Scroll to next/previous slide
				if (clickX > containerWidth * 0.6) {
					// Right side - next slide
					container.scrollBy({ 
						left: containerWidth, 
						behavior: 'smooth' 
					});
				} else if (clickX < containerWidth * 0.4) {
					// Left side - previous slide  
					container.scrollBy({ 
						left: -containerWidth, 
						behavior: 'smooth' 
					});
				}
				// Middle area (0.4 to 0.6) - no action to avoid accidental scrolls
			});
		}
	</script>
</html>
